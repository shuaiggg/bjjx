var eventEmitter=require("../../eventEmitter"),userData=require("../../data/user"),store=require("../../store"),info=require("../../info"),$=require("../../jquery"),language=require("../../language/main")(),auth=require("../../auth");function userIsExclude(e,t){for(var i,r=0;i=t[r++];)if(i==e)return!0;return!1}function findeUserIndex(e,t){for(var i,r=0;i=t[r++];)if(i.id==e)return r-1;return-1}Component({properties:{excludeUsers:{type:Array,value:[],observer:function(e,t){e&&this.setUserList(this.data.allUserList)}},styleInfo:{type:Object,value:{playerWidth:100,playerHeight:75,wrapWidth:300,gap:10,fontSize:12,direction:"row"},observer:function(e,t){$.isEmptyObject(e)||this.resize()}}},data:{userList:[],allUserList:[],direction:"row",size:{}},ready:function(){var a=this;eventEmitter.on(eventEmitter.MEDIA_PUBLISH,function(e,t){var i=t.user,r=a.data,s=r.allUserList;r.excludeUsers;auth.isTeacher(i.type)||(auth.isSelf(i.id)||(i.canPlay=!userData.isAudioSpeex(i),-1!=findeUserIndex(i.id,s)?a.updateUser(i):(i.videoOn||i.audioOn)&&(s.push(i),a.setUserList(s))))}).on(eventEmitter.MEDIA_REPUBLISH,function(e,t){var i=t.user;auth.isTeacher(i.type)||auth.isSelf(i.id)||(i.canPlay=!userData.isAudioSpeex(i),-1!=findeUserIndex(i.id,a.data.allUserList)&&a.updateUser(i))}).on(eventEmitter.USER_OUT,function(e,t){var i=t.user,r=a.data.allUserList,s=findeUserIndex(i.id,r);-1!=s&&(r.splice(s,1),console.log(r),a.setUserList(r))})},methods:{setSize:function(e,t){var i=this.data.styleInfo;this.setData({size:{width:e||i.playerWidth,height:t||i.playerHeight,gap:0}})},setUserList:function(e){for(var t,i=this,r=(i.data.styleInfo,[]),s=0;t=e[s++];)userIsExclude(t.id,i.data.excludeUsers)||r.push(t);i.setData({allUserList:e,userList:r}),i.triggerEvent("setUserList",{userList:i.data.userList,allUserList:e}),i.resize()},resize:function(){var e=this,t=e.data.userList,i=(a=e.data.styleInfo).playerWidth,r=i/2,s=Math.floor(a.wrapWidth/t.length),a=e.data.styleInfo;r<s&&s<i?(e.setSize(s,a.playerHeight),a.fontSize=12):s<r?(e.setSize(r,a.playerHeight/2),a.fontSize=9,e.setData({styleInfo:a})):(e.setSize(a.playerWidth,a.playerHeight),a.fontSize=12)},updateUser:function(e){var t=this.data.allUserList,i=findeUserIndex(e.id,t);-1!=i&&(e.audioOn||e.videoOn?t[i]=e:t.splice(i,1)),this.setUserList(t)},onPlayerTap:function(e){this.triggerEvent("userPlayerTap",e.detail)},onPlayerAVStatusChange:function(e){this.triggerEvent("AVStatusChange",e.detail)},onSupportedChanged:function(e){console.log("onSupportedChanged"),console.log(e),this.triggerEvent("isSupportedChanged",e.detail)}}});