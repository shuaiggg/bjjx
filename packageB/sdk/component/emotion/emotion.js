var pageSize,util=require("../../util"),eventEmitter=require("../../eventEmitter"),emotionData=require("../../data/emotion"),compressImage=require("../../function/compressImage"),$=require("../../jquery");$.extend(eventEmitter,require("./eventEmitter"));var defaultOptions={rowPerPage:4,imgWidth:32,imgHeight:32,emotionPerRow:8},emptyEmotion={name:"emptyFill",key:"emptyFill"};function fillArrayLength(e,t,r){var a=t-e.length;if(0<a)for(var i=a;0<i;)e.push(r),i--;return e}function createEmptyRow(e){for(var t=[],r=0;r<e;r++)t.push(emptyEmotion);return t}Component({properties:{emotionData:{type:"array",value:function(){return util.copy(store.get("partner.customExpression"))||[]},observer:function(e,t){this.computeAllData()}},rowPerPage:{type:"number",value:defaultOptions.rowPerPage},emotionPerRow:{type:"number",value:defaultOptions.emotionPerRow},imgWidth:{type:"number",value:defaultOptions.imgWidth},imgHeight:{type:"number",value:defaultOptions.imgHeight},showImgName:{type:"boolean",value:!1}},data:{allPageData:[]},methods:{imgTap:function(e){var t=e.target.dataset;t.stringify=emotionData.stringify(t.key),eventEmitter.trigger(eventEmitter.EMOTION_SEND,t),this.triggerEvent("emotionTap",t)},computeAllData:function(){var e=this,t=e.data;pageSize=t.rowPerPage*t.emotionPerRow;for(var r=Math.ceil(t.emotionData.length/pageSize),a=[],i=1;i<=r;i++)a.push(e.getPageData(i));e.setData({allPageData:a})},getPageData:function(e){for(var t,r=this,a=[],i=r.data,o=(e-1)*pageSize,n=i.emotionData.slice(o,o+pageSize),m=i.emotionPerRow,g=[],u=0;t=n[u++];)t.src=compressImage({url:t.url,width:r.data.imgWidth,height:r.data.imgHeight}),g.push(t),u%m==0&&(a.push(g),g=[]);return 0<g.length&&(fillArrayLength(g,i.emotionPerRow,emptyEmotion),a.push(g)),a.length<i.rowPerPage&&fillArrayLength(a,i.rowPerPage,createEmptyRow(i.emotionPerRow)),a}},ready:function(){}});