var config=require("../../config"),info=require("../../info"),eventEmitter=require("../../eventEmitter"),auth=require("../../auth"),$=require("../../jquery"),emotionData=require("../../data/emotion"),appLanguage=require("../../language/main")(),pageLanguage=require("./language/main")();function isReservedWord(e){for(var t,n=[config.DEBUG_KEY,config.OPEN_VCONSOLE],a=0;t=n[a++];)if(t==e)return!0;return!1}Object.assign(pageLanguage,appLanguage),Component({properties:{placeholder:{type:"String",value:""},messageMaxLength:{type:"Number",value:140},focus:{type:"Boolean",value:!1},isBJY:{type:"Boolean",value:!1},confirmHold:{type:"Boolean",value:!1}},data:{forbidden:!1,allForbidden:!1,language:pageLanguage,content:"",messageValue:"",emotionList:[],messageCommand:"",isCommandInputError:!1},methods:{triggerEmotionToggle:function(){var t=this,e=wx.createSelectorQuery().in(t);e.select("#bjy-message-sender").boundingClientRect(),e.exec(function(e){t.triggerEvent("heightChange",{height:e[0].height,top:e[0].top,showEmotion:t.data.showEmotion})})},iconTap:function(e){var t=this,n=e.target.dataset.name;"emotion"==n?t.setData({showEmotion:!0}):"inEmotion"==n&&t.setData({showEmotion:!1,focus:!0}),t.triggerEmotionToggle()},emotionTap:function(e){var t=this;t.sendEmoji(e.detail),t.setData({showEmotion:!1}),t.triggerEmotionToggle()},sendEmoji:function(e){eventEmitter.trigger(eventEmitter.MESSAGE_SEND,{content:e.stringify,data:{type:"emoji",key:e.key,url:e.url}}),this.triggerEvent("sendMessage",{content:e.stringify})},validate:function(){var e=this,t=e.data,n=t.content,a=t.messageCommand,o=t.messageMaxLength;t.language;if(!(0<o&&n.length>o))return a&&a!==n&&(this.setData({isCommandInputError:!0}),setTimeout(function(){e.data.isCommandInputError&&e.setData({isCommandInputError:!1})},1e3)),this.setData({confirmHold:!1}),!0;info.alert(getLanguage().ERROR_TOO_LONG)},sendMessage:function(e){var t=this,n=$.trim(e.detail.value);t.setData({content:n}),n&&t.validate()&&(t.setData({messageValue:""}),t.data.isBJY&&isReservedWord(n)||eventEmitter.trigger(eventEmitter.MESSAGE_SEND,{content:n}),t.triggerEvent("sendMessage",{content:n,command:t.data.messageCommand}))}},ready:function(){var n=this;n.namespace=".message_sender",0!=emotionData.all().length?n.setData({emotionList:emotionData.all()}):eventEmitter.on(eventEmitter.INTERFACE_FETCH_SUCCESS,function(){n.setData({emotionList:emotionData.all()})}),eventEmitter.on(eventEmitter.STANDARD_LOTTERY_END+n.namespace,function(){n.setData({focus:!1})}).on(eventEmitter.COMMAND_LOTTERY_ABORT+n.namespace,function(e,t){n.setData({messageCommand:"",focus:!1})}).on(eventEmitter.LOTTERY_BOX_CLICKED+n.namespace,function(e,t){n.setData({content:"",messageCommand:t.command})}).on(eventEmitter.COMMAND_LOTTERY_HIT_RES+n.namespace,function(e,t){console.log(111),n.setData({isCommandInputError:!1,messageCommand:""})})}});