var streamNameForResume,$=require("../../jquery"),info=require("../../info"),eventEmitter=require("../../eventEmitter"),userData=require("../../data/user"),language=require("../../language/main")(),getStreamName=require("../../function/getStreamName");function getChangeType(e,t){var a={};return e.videoOn&&!t.videoOn&&(a.videoTo=!1),!e.videoOn&&t.videoOn&&(a.videoTo=!0),e.audioOn&&!t.audioOn&&(a.audioTo=!1),!e.audioOn&&t.audioOn&&(a.audioTo=!0),a}Component({properties:{showName:{type:Boolean,value:!0},styleInfo:{type:Object,value:{fontSize:12}},coverImage:{type:String,value:"/sdk/component/player/image/closeCamera.png"},fullScreen:{type:Boolean,value:!1,observer:function(e,t){console.log("fullScreen");var a="player"+this.data.userInfo.id,o=wx.createLivePlayerContext(a,this);console.log(a),console.log(o),!0===e?o.requestFullScreen():o.exitFullScreen()}},stopPlay:{type:Boolean,value:!1,observer:function(e,t){console.log("stopPlay change");var a=this,o="player-"+a.data.userInfo.id;console.log(o);wx.createLivePlayerContext(o,a);!0===e?(streamNameForResume=a.data.streamName,a.setData({streamName:"rtmp://a"})):!0===t&&!1===e&&a.setData({streamName:streamNameForResume})}},userInfo:{type:Object,value:{videoOn:!1},observer:function(e,t){var a=this;if(!$.isEmptyObject(e)){var o=!e.canPlay;console.log("streamName:"),console.log(getStreamName(e)),a.setData({streamName:""}),a.setData({notSupported:o,streamName:getStreamName(e)}),a.triggerEvent("isSupportedChanged",{user:e,support:!o})}var n={};$.isEmptyObject(e)||(n=getChangeType(t,e)),$.isEmptyObject(n)||a.triggerEvent("AVStatusChange",{user:e,support:!a.data.notSupported,changeInfo:n})}}},data:{language:language,notSupported:!1,streamName:""},ready:function(){var t=this;eventEmitter.on(eventEmitter.DOWNLINK_SERVER_CHANGE_TRIGGER,function(){var e=t.data.userInfo;$.isEmptyObject(e)||(t.setData({streamName:""}),t.setData({streamName:getStreamName(e)}))}).on(eventEmitter.NETWORK_RECONNECT,function(){var e=t.data.streamName;t.setData({streamName:""}),t.setData({streamName:e})})},methods:{onStateChange:function(e){var t=e.detail.code;2001==t||2002==t||2007==t?this.setData({showLoading:!0}):this.setData({showLoading:!1})},onError:function(e){console.log("live-player code:",e.detail.code)},onNetStatus:function(e){console.log("on Ne tStatus"),console.log(e.detail),this.triggerEvent("netStatus",e.detail)},onItemTap:function(e){this.triggerEvent("optTap",e.detail)},onPlayerLongTap:function(){"longTap"==this.data.optTriggerType&&this.showOptBar()},onFullscreenChange:function(e){info.tip("onFullscreenChange")},onPlayerTap:function(){var e=this;console.log("onPlayerTap"),e.triggerEvent("playerTap",{user:e.data.userInfo,support:!e.data.notSupported})}}});