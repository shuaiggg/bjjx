var classData=require("../../data/class"),userSpeak=require("../../userSpeak"),info=require("../../info"),auth=require("../../auth"),store=require("../../store"),$=require("../../jquery"),language=require("../../language/main")(),eventEmitter=require("../../eventEmitter"),config=require("../../config");function checkClassStarted(){var t=classData.isStarted();return t||info(language.INFO_CAN_NOT_DO_BEFORE_START_CLASS),t}Component({properties:{},data:{canApplySpeak:!1,wrapperClass:"",statusConfig:{NOT_HANDUP:1,WAITING_RES:2,SPEAKING:3},status:1},ready:function(){this.bindEvent()},methods:{bindEvent:function(){var n=this,r=n.data.statusConfig;eventEmitter.on(eventEmitter.VIEW_RENDER_TRIGGER,function(){n.setData({canApplySpeak:auth.canApplySpeak()})}).on(eventEmitter.MEDIA_PUBLISH,function(t,e){var a=e.user;auth.isSelf(e.user.id)&&(a.videoOn||a.audioOn?n.setData({status:r.SPEAKING}):n.setData({status:r.NOT_HANDUP,wrapperClass:""}))}).on(eventEmitter.SPEAK_APPLY_RESULT_TIMEOUT,function(){info.tip(language.INFO_SPEAK_APPLY_TIMEOUT),n.setData({status:r.NOT_HANDUP,wrapperClass:""})}).on(eventEmitter.SPEAK_APPLY_RESULT_ACCEPT,function(){info.tip(language.INFO_SPEAK_APPLY_ACCEPT),n.triggerEvent("speakApplyAccect",{user:store.get("user")})}).on(eventEmitter.SPEAK_APPLY_RESULT_REJECT,function(){info.tip(language.INFO_SPEAK_APPLY_REJECT),n.setData({status:r.NOT_HANDUP,wrapperClass:""}),n.triggerEvent("speakApplyReject",{user:store.get("user")})}).on(eventEmitter.SPEAK_INVITE_RES_TRIGGER,function(t,e){e.accept&&e.force&&n.setData({status:r.SPEAKING})}).on(eventEmitter.SPEAK_APPLY_DENY,function(t,e){info.tip(language.SERVER_CONCURRENCY_REJECT),n.cancelHandup()}).on(eventEmitter.PAGE_HIDE,function(t,e){eventEmitter.trigger(eventEmitter.SPEAK_STOP_TRIGGER)})},handleApply:function(){if(classData.getForbidSpeakApply())return info(language.INFO_TEACHER_FORBID_RAISE_HAND),!1;if(auth.isSpeakingDisabled())return info(store.get("partner.disableSpeakingRequestReason")),!1;if(auth.canApplySpeak()&&checkClassStarted()){var t=store.get("partner.liveRaiseHandTimeout");"number"===$.type(t)?t*=1e3:t=config.SPEAK_APPLY_TIMEOUT_BJY,eventEmitter.trigger(eventEmitter.SPEAK_START_TRIGGER,{timeout:t})}},onHandupEndTap:function(t){info.confirm({content:language.CONFIRM_END_SPEAK}).done(function(){var t=store.get("user");userSpeak.stopSpeak(t.id)})},cancelHandup:function(){var t=this.data.statusConfig;eventEmitter.trigger(eventEmitter.SPEAK_CANCEL_TRIGGER),this.setData({status:t.NOT_HANDUP,wrapperClass:""})},onHandupTap:function(t){var e=this,a=e.data.statusConfig,n=e.data.status;n==a.NOT_HANDUP?(e.handleApply(),e.setData({status:a.WAITING_RES,wrapperClass:"waiting"})):n==a.WAITING_RES&&e.cancelHandup()}}});