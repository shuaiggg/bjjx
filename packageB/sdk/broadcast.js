var toBoolean=require("./function/toBoolean"),eventEmitter=require("./eventEmitter"),roomServer=require("./server/room"),classData=require("./data/class"),store=require("./store");exports.messageTypes={forbid_all_change:function(e,t,r){var s=classData.getForbidAll(),a=+t.forbidAll;s!==a&&(classData.setForbidAll(a),eventEmitter.trigger(eventEmitter.MESSAGE_SEND_FORBID_ALL_CHANGE,{forbidAll:!!a,cache:r}))},forbid_raise_hand_change:function(e,t,r){var s=classData.getForbidSpeakApply(),a=t.forbid?1:0;s!==a&&(classData.setForbidSpeakApply(a),eventEmitter.trigger(eventEmitter.SPEAK_APPLY_FORBID_ALL_CHANGE,{forbidAll:1===a,cache:r}))},speak_raise:function(e,t){var r=t.user_id;store.get("user.id")===r&&store.set("class.speakRaised",!0),eventEmitter.trigger(eventEmitter.SPEAK_RAISE,{userId:r})},speak_lay:function(e,t){var r=t.user_id;store.get("user.id")===r&&store.set("class.speakRaised",!1),eventEmitter.trigger(eventEmitter.SPEAK_LAY,{userId:r})},share_desktop:function(e,t,r){var s=t.sharing?eventEmitter.SCREEN_SHARE_START_BROADCAST:eventEmitter.SCREEN_SHARE_STOP_BROADCAST;eventEmitter.trigger(s,{fromCache:r})}},exports.send=function(e,t,r){roomServer.sendBroadcast({key:e,value:t,options:r})},exports.get=function(e){roomServer.getCachedBroadcast({key:e})},exports.init=function(){eventEmitter.on(eventEmitter.BROADCAST_RECEIVE,function(e,t){var r=t.fromId,s=exports.messageTypes[t.key];s&&s(r,t.value)}).on(eventEmitter.BROADCAST_CACHE_RES,function(e,t){var r=t.fromId,s=exports.messageTypes[t.key];s&&s(r,t.value,!0)}).on(eventEmitter.BROADCAST_SEND,function(e,t){var r=t.name;r&&exports.send(r,t.params,{cache:toBoolean(t.cache,!1),all:toBoolean(t.all,!0)})}).on(eventEmitter.SPEAK_RAISE_TRIGGER,function(e,t){exports.send("speak_raise",{user_id:t.userId})}).on(eventEmitter.SPEAK_LAY_TRIGGER,function(e,t){exports.send("speak_lay",{user_id:t.userId})})},exports.CLASS_TIME="class_time";