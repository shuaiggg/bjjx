var lpad=require("../function/lpad"),classData=require("../data/class"),serverData=require("../data/server"),getNextServer=require("../function/getNextServer"),findServer=require("../function/findServer"),switchServer=require("../function/switchServer"),config=require("../config"),$=require("../jquery"),eventEmitter=require("../eventEmitter");exports.activeUplinkServer,exports.activeDownlinkServer,exports.init=function(){exports.downlinkServerList=serverData.getLiveServerList(),eventEmitter.on(eventEmitter.CLASSROOM_EXIT_TRIGGER,function(){exports.activeDownlinkServer=null})},exports.getUplinkStreamName=function(e){return"rtmp://"+exports.getActiveUplinkServer()+"/mgclient/"+classData.getClassId()+"-"+e.id+"000"+(e.publishIndex+1)},exports.getUplinkStreamNamePattern=function(){return/^(\w+)-(\w+)(\d{3})[0|1]$/},exports.getDownlinkStreamName=function(e,r){return"rtmp://"+exports.getActiveDownlinkServer().pull+"/mgclient/"+classData.getClassId()+"-"+e+lpad(r,3)+"1"},exports.getDownlinkAudioMixedStreamName=function(e,r){return"rtmp://"+exports.getActiveDownlinkServer().ip+"/mgclient/"+classData.getClassId()+"-"+(+e+2)+lpad(r,3)+"0"},exports.getDownlinkStreamNamePattern=function(){return/^(\w+)-(\w+)(\d{3})[0|1](?:\?only-audio=1)?$/},exports.getActiveUplinkServer=function(){return exports.activeUplinkServer||exports.uplinkServerList[0]},exports.setActiveUplinkServer=function(e){exports.activeUplinkServer=e},exports.getActiveDownlinkServer=function(){return exports.activeDownlinkServer||exports.downlinkServerList[0]},exports.setActiveDownlinkServer=function(e){exports.activeDownlinkServer=e},exports.switchUplinkServer=function(e,r){return exports.setActiveUplinkServer(switchServer(exports.uplinkServerList,e,r)),exports.getActiveUplinkServer()},exports.switchDownlinkServer=function(e,r){return exports.setActiveDownlinkServer(switchServer(exports.downlinkServerList,e,r)),exports.getActiveDownlinkServer()};